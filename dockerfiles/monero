FROM ubuntu:22.04 AS og

WORKDIR /opt/monero

# Update system and install dependencies
RUN apt-get update \
  && apt-get upgrade -y \
  && apt-get install -y \
  tar wget bzip2 gnupg

# Copy static files
COPY ./dockerfiles/files/monerod/binaryfate.asc .
COPY ./dockerfiles/files/monerod/hashes.txt .
COPY ./dockerfiles/files/monerod/install.sh .

# Run install script
RUN bash install.sh

# Copy to fresh Ubuntu image to reduce size
FROM ubuntu:22.04
COPY --from=og /usr/local/bin/monerod /usr/local/bin/monerod
COPY --from=og /usr/local/bin/monero-wallet-cli /usr/local/bin/monero-wallet-cli
COPY --from=og /usr/local/bin/monero-wallet-rpc /usr/local/bin/monero-wallet-rpc
COPY ./dockerfiles/files/monerod/ban_list.txt /ban_list.txt
COPY ./dockerfiles/files/monerod/monerod_entrypoint.sh /entrypoint.sh
RUN chmod +x /entrypoint.sh

EXPOSE 18080
EXPOSE 18081
EXPOSE 18082
EXPOSE 18083
